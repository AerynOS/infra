{% extends "skel.html.jinja" %}
{% block body %}
    <div hx-ext="sse" sse-connect="/sse" sse-swap="tasks" style="display: contents;">
        {% include 'tasks-table.html.jinja' %}
    </div>
{% endblock %}

{% block javascript %}
    <script>
        bind();

        document.body.addEventListener('htmx:afterSwap', (_) => bind());

        function bind() {
            const taskSortSelect = document.getElementById('taskSortSelect');
            const taskFilterSelect = document.getElementById('taskFilterSelect');
            const searchTasksInput = document.getElementById('searchTasksInput');

            const urlParams = new URLSearchParams(window.location.search);
            const sort = urlParams.get('sort');
            const order = urlParams.get('order');
            const status = urlParams.get('status');

            searchTasksInput.addEventListener('keydown', function (e) {
                if (e.key === 'Enter') {
                    let url = [];

                    url.push('search_tasks=' + e.target.value);

                    if (sort && order) {
                        url.push('sort=' + sort);
                        url.push('order=' + order);
                    }

                    if (status) {
                        url.push('status=' + status);
                    }

                    window.location.href = url.length > 0 ? `?${url.join('&')}` : '';
                }
            });

            taskSortSelect.addEventListener('change', function(e) {
                window.location.href = '?' + this.value;
            });

            taskFilterSelect.addEventListener('change', function(e) {
                window.location.href = '?' + this.value;
            });
        }
    </script>
{% endblock %}
